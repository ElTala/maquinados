{% extends "base.html" %}
{% block title %}Dashboard de Proyecto{% endblock %}

{% block content %}
<section class="bg-white/90 backdrop-blur-sm rounded-lg shadow-lg w-full p-8 mx-auto">
  <h2 class="text-3xl font-semibold text-center text-gray-800 mb-8">
    Status de maquinados
  </h2>

  <div class="space-y-8">
    {% for proyecto, maqs in grouped_maquinados.items() %}
      <details open class="border border-gray-200 rounded-lg">
        <summary class="cursor-pointer select-none text-lg font-semibold px-6 py-4 bg-gray-100">
          {{ proyecto }}
        </summary>

        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200 text-sm">
            <thead class="bg-gray-50">
              <tr class="text-left">
                <th class="px-6 py-3">Archivo</th>
                <th class="px-6 py-3">Parte</th>
                <th class="px-6 py-3">Descripci√≥n</th>
                <th class="px-6 py-3">Empleado</th>
                <th class="px-6 py-3">Manufacturer</th>
                <th class="px-6 py-3">Comentarios</th>
                <th class="px-6 py-3">PDF</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
              {% for m in maqs %}
                <tr class="whitespace-nowrap">
                  <td class="px-6 py-2">{{ m.pdf }}</td>
                  <td class="px-6 py-2">{{ m.partnumber }}</td>
                  <td class="px-6 py-2">{{ m.descripcion }}</td>
                  <td class="px-6 py-2">{{ m.empleado }}</td>
                  <td class="px-6 py-2">{{ m.manofacturador }}</td>
                  <td class="px-6 py-2">{{ m.comentarios }}</td>
                  <td class="px-6 py-2">
                    <a href="{{ url_for('static', filename='uploads/pdf/' + m.pdf) }}"
                       class="px-3 py-1 rounded-md bg-red-600 text-white hover:bg-red-700 transition">
                      Ver
                    </a>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </details>
    {% endfor %}
  </div>
</section>
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.4/socket.io.min.js"></script>
<script>
  const socket = io();
  socket.on('receive_maquinado', () => location.reload());
</script>
{% endblock %}
